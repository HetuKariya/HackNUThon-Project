{% extends 'base.html' %}
{% block title %}
  Register Page
{% endblock %}
{% block content %}
  <div class="container register-container">
      <h2 class="register-title">Create an Account</h2>
      <form method="POST" action="">
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="firstName">First Name</label>
            <input type="text" class="form-control" id="firstName" name="firstName" placeholder="Enter your first name" required>
          </div>
          <div class="form-group col-md-6">
            <label for="lastName">Last Name</label>
            <input type="text" class="form-control" id="lastName" name="lastName" placeholder="Enter your last name" required>
          </div>
        </div>
        <div class="form-group">
          <label for="email">Email address</label>
          <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label for="password1">Password</label>
          <input type="password" class="form-control" id="password1" name="password1" placeholder="Create a password" required>
          <small class="form-text text-muted">Password must be at least 8 characters long</small>
        </div>
        <div class="form-group">
          <label for="password2">Confirm Password</label>
          <input type="password" class="form-control" id="password2" name="password2" placeholder="Confirm your password" required>
        </div>
        <div class="form-group form-check">
          <input type="checkbox" class="form-check-input" id="terms" required>
          <label class="form-check-label" for="terms">I agree to the <a href="#">Terms & Conditions</a></label>
        </div>
        <button type="submit" class="btn btn-primary">Create Account</button>
      </form>
      <div class="register-footer">
        <p>Already have an account? <a href="{{ url_for('login_page') }}">Login here</a></p>
      </div>
    </div>
{% endblock %}
{% block style %}
  body {
        background-color: #212121;
        color: white;
      }
      .register-container {
        max-width: 500px;
        margin: 80px auto;
        padding: 25px;
        background-color: #303030;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }
      .form-control {
        background-color: #424242;
        color: white;
        border: 1px solid #555;
      }
      .form-control:focus {
        background-color: #424242;
        color: white;
        border-color: #80bdff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
      }
      .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
        width: 100%;
      }
      .register-title {
        text-align: center;
        margin-bottom: 25px;
      }
      .register-footer {
        text-align: center;
        margin-top: 20px;
      }
{% endblock %}
{% block script %}
function validateEmail(email) {
  const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
  return re.test(String(email).toLowerCase());
}

function validatePassword(password) {
  return password.length >= 8;
}

function showError(input, message) {
  const formGroup = input.parentElement;
  const small = document.createElement('small');
  small.className = 'form-text text-danger error-message';
  small.innerText = message;

  const existingErrors = formGroup.querySelectorAll('.error-message');
  existingErrors.forEach(error => error.remove());

  formGroup.appendChild(small);
  input.classList.add('is-invalid');
}

function showSuccess(input) {
  input.classList.remove('is-invalid');
  input.classList.add('is-valid');

  const formGroup = input.parentElement;
  const existingErrors = formGroup.querySelectorAll('.error-message');
  existingErrors.forEach(error => error.remove());
}

function setupPasswordToggle(passwordField) {
  const parentEl = passwordField.parentElement;
  const toggleContainer = document.createElement('div');
  toggleContainer.style.position = 'relative';
  const toggleIcon = document.createElement('i');
  toggleIcon.style.position = 'absolute';
  toggleIcon.style.right = '10px';
  toggleIcon.style.top = '10px';
  toggleIcon.style.cursor = 'pointer';
  toggleIcon.style.color = '#aaa';

  parentEl.replaceChild(toggleContainer, passwordField);
  toggleContainer.appendChild(passwordField);
  toggleContainer.appendChild(toggleIcon);

  toggleIcon.addEventListener('click', function() {
    if (passwordField.type === 'password') {
      passwordField.type = 'text';
      toggleIcon.style.color = '#007bff';
    } else {
      passwordField.type = 'password';
      toggleIcon.style.color = '#aaa';
    }
  });
}

window.addEventListener('DOMContentLoaded', function() {
  const password1 = document.getElementById('password1');
  const password2 = document.getElementById('password2');
  if (password1) setupPasswordToggle(password1);
  if (password2) setupPasswordToggle(password2);
});

const registerForm = document.querySelector('form');
registerForm.addEventListener('submit', function(e) {
  e.preventDefault();
  let isValid = true;

  const firstName = document.getElementById('firstName');
  const lastName = document.getElementById('lastName');
  const email = document.getElementById('email');
  const password1 = document.getElementById('password1');
  const password2 = document.getElementById('password2');
  const terms = document.getElementById('terms');

  if (firstName.value.trim() === '') {
    showError(firstName, 'First name is required');
    isValid = false;
  } else {
    showSuccess(firstName);
  }

  if (lastName.value.trim() === '') {
    showError(lastName, 'Last name is required');
    isValid = false;
  } else {
    showSuccess(lastName);
  }

  if (email.value.trim() === '') {
    showError(email, 'Email is required');
    isValid = false;
  } else if (!validateEmail(email.value.trim())) {
    showError(email, 'Email is not valid');
    isValid = false;
  } else {
    showSuccess(email);
  }

  if (password1.value === '') {
    showError(password1, 'Password is required');
    isValid = false;
  } else if (!validatePassword(password1.value)) {
    showError(password1, 'Password must be at least 8 characters long');
    isValid = false;
  } else {
    showSuccess(password1);
  }

  if (password2.value === '') {
    showError(password2, 'Please confirm your password');
    isValid = false;
  } else if (password1.value !== password2.value) {
    showError(password2, 'Passwords do not match');
    isValid = false;
  } else {
    showSuccess(password2);
  }

  if (!terms.checked) {
    showError(terms, 'You must agree to the terms and conditions');
    isValid = false;
  } else {
    showSuccess(terms);
  }

  if (isValid) {
    registerForm.submit();
  }
});

document.getElementById('password1').addEventListener('input', function() {
  if (this.value.length < 8) {
    showError(this, 'Password must be at least 8 characters long');
  } else {
    showSuccess(this);
  }
});

document.getElementById('password2').addEventListener('input', function() {
  const password1 = document.getElementById('password1');
  if (this.value !== password1.value) {
    showError(this, 'Passwords do not match');
  } else {
    showSuccess(this);
  }
});
{% endblock %}